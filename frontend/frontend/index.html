<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>映画リコメンダー</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h1>映画リコメンダー</h1>

  <!-- ① トレンド期間のドロップダウン -->
  <select id="period-select">
    <option value="day">日刊トレンド</option>
    <option value="week" selected>週刊トレンド</option>
    <option value="month">月刊トレンド</option>
  </select>

  <!-- ② キーワード検索フォーム -->
  <input type="text" id="query-input" placeholder="キーワードで検索" />

  <button id="recommend-btn">おすすめ映画を取得</button>

  <!-- 結果表示 -->
  <div id="result">
    <h2 id="movie-title"></h2>
    <img id="movie-poster" src="" alt="" style="max-width:300px; display:none;" />
    <p id="movie-overview"></p>
    <p id="movie-rating"></p>
  </div>

  <script>
    const btn = document.getElementById('recommend-btn');
    const resultTitle = document.getElementById('movie-title');
    const resultPoster = document.getElementById('movie-poster');
    const resultOverview = document.getElementById('movie-overview');
    const resultRating = document.getElementById('movie-rating');
    const periodSelect = document.getElementById('period-select');
    const queryInput = document.getElementById('query-input');

    btn.addEventListener('click', () => {
      const period = periodSelect.value;
      const query = queryInput.value.trim();
      let url = `/recommend?period=${period}`;
      if (query) {
        url += `&query=${encodeURIComponent(query)}`;
      }

      // まず /recommend で ID とタイトルを取る
      fetch(url)
        .then(res => res.json())
        .then(data => {
          // 次に /movie/{id} で詳細を取りに行く
          return fetch(`/movie/${data.id}`);
        })
        .then(res => res.json())
        .then(info => {
          resultTitle.textContent = info.title;
          resultOverview.textContent = info.overview;
          resultRating.textContent = `評価: ${info.rating}`;
          resultPoster.src = info.poster_url;
          resultPoster.style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          resultTitle.textContent = 'エラーが発生しました';
        });
    });
  </script>
</body>
</html>